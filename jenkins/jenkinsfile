#!groovy

// Run docker build

properties([disableConcurrentBuilds()])



pipeline {

    agent { 

        label 'master'

        }

    triggers { pollSCM('* * * * *') }

    options {

        buildDiscarder(logRotator(numToKeepStr: '10', artifactNumToKeepStr: '10'))

        timestamps()

    }

    stages {

        stage("docker login") {

            steps {

                echo " ============== docker login =================="

                withCredentials([usernamePassword(credentialsId: 'dockerhub_hovo', usernameVariable: 'UERNAME', passwordVariable: 'PASSWORD')]) {

                    sh """

                    docker login -u $hovo14 -p $fearme1$

                    """

                }

            }

        }

        stage("create docker image") {

            steps {

                echo " ============== start building image =================="

                dir ('docker') {

                sh 'docker build -t hovops/nginx . '

                }
            }

        }

        stage("docker push") {

            steps {

                echo " ============== start pushing image =================="

                sh '''

                docker push hovops/nginx

                '''

            }

        }

    }

}
        
